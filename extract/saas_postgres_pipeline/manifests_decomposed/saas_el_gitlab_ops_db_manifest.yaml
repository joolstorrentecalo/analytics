connection_info:
  postgres_source_connection:
    database: GITLAB_OPS_DB_NAME
    host: GITLAB_OPS_DB_HOST
    pass: GITLAB_OPS_DB_PASS
    port: PG_PORT
    user: GITLAB_OPS_DB_USER
  postgres_metadata_connection:
    database: GITLAB_METADATA_DB_NAME
    host: GITLAB_METADATA_DB_HOST
    pass: GITLAB_METADATA_DB_PASS
    port: GITLAB_METADATA_PG_PORT
    user: GITLAB_METADATA_DB_USER
tables:
  ci_pipelines:
    dbt_source_model: true
    export_schema: 'gitlab_ops_net'
    export_table: 'ci_pipelines'
    export_table_primary_key: id
    import_db: GITLAB_OPS_DB
    import_query: |-
      SELECT id
      , created_at
      , updated_at
      , ref
      , tag
      , yaml_errors
      , committed_at
      , project_id
      , status
      , started_at
      , finished_at
      , duration
      , user_id
      , lock_version
      , auto_canceled_by_id
      , pipeline_schedule_id
      , source
      , config_source
      , protected
      , failure_reason
      , iid
      , merge_request_id
      FROM ci_pipelines
      WHERE updated_at BETWEEN '{EXECUTION_DATE}'::timestamp - interval '{HOURS} hours'
        AND '{EXECUTION_DATE}'::timestamp
  ci_stages:
    dbt_source_model: true
    export_schema: 'gitlab_ops_net'
    export_table: ci_stages
    export_table_primary_key: id
    import_db: GITLAB_OPS_DB
    import_query: |-
      SELECT id
      , project_id
      , pipeline_id
      , created_at
      , updated_at
      , name
      , status
      , lock_version
      , position
      FROM ci_stages
      WHERE updated_at BETWEEN '{EXECUTION_DATE}'::timestamp - interval '{HOURS} hours'
        AND '{EXECUTION_DATE}'::timestamp
  labels:
    dbt_source_model: true
    export_schema: 'gitlab_ops_net'
    export_table: 'labels'
    export_table_primary_key: id
    import_db: GITLAB_OPS_DB
    import_query: |-
      SELECT id
      , title
      , color
      , project_id
      , created_at
      , updated_at
      , template
      , type
      , group_id
      FROM labels
      WHERE updated_at BETWEEN '{EXECUTION_DATE}'::timestamp - interval '{HOURS} hours'
        AND '{EXECUTION_DATE}'::timestamp
