version: 2

models:
  - name: wk_customers_db_license_versions
    tags: ["exception", "product"]
    description: Self-managed EE instances will send seat link information to the customers portal on a daily basis. This information includes a license version data. Additional detail can be found in [this doc](https://gitlab.com/gitlab-org/customers-gitlab-com/-/blob/staging/doc/reconciliations.md).
    columns:
      - name: id
        description: Pseudo ID generated to simulate Primary Key
        tags:
          - customers_db
      - name: item_id
        description: Line if for item
        tags:
          - customers_db
      - name: created_at
        description: Timestamp when the record was created
        tags:
          - customers_db
      - name: item_type
        description: Item type, for example - License
        tags:
          - customers_db
      - name: event
        description: Name of the event, for example - create, update
        tags:
          - customers_db
      - name: whodunnit
        description: Email for licensing
        tags:
          - customers_db
      - name: whodunnit_gitlab
        description: Email for licensing, contains either @gitlab.com email (value from whodunnit)  or NULL
        tags:
          - customers_db
      - name: whodunnit_gitlab_desc
        description: Email for licensing, contains either @gitlab.com email or NULL. Can contain `Admin` string
        tags:
          - customers_db
      - name: object
        description: Details about license
        tags:
          - customers_db
      - name: object_changes
        description: Details about license changes
        tags:
          - customers_db
      - name: _uploaded_at
        description: Timestamp when record is inserted in the RAW layer

  - name: wk_rpt_event_namespace_plan_monthly
    description: '{{ doc("wk_rpt_event_namespace_plan_monthly") }}'
    columns:
      - name: namespace_monthly_pk
        description: The unique identifier for an ultimate parent namespace and calendar month, generated by the surrogate_key macro in dbt
        tests:
          - not_null
          - unique
      - name: event_calendar_month
        description: '{{ doc("event_calendar_month") }}'
      - name: dim_ultimate_parent_namespace_id
        description: '{{ doc("dim_ultimate_parent_namespace_id") }}'
      - name: plan_id_at_event_month
        description: The ID of the ultimate parent namespace's plan on the final event in the calendar month (ex. 34, 100, 101, etc). Defaults to '34' (free) if a value is not available.
      - name: plan_name_at_event_month
        description: The name of the ultimate parent namespace's plan on the final event in the calendar month (ex. free, premium, ultimate, etc). Defaults to 'free' if a value is not available.
      - name: plan_was_paid_at_event_month
        description: Boolean flag which is set to True if the ultimate parent namespace's plan was paid on the final event in the calendar month. Defaults to False if a value is not available.
      - name: plan_id_count
        description: The distinct count of plan IDs associated with the ultimate parent namespace during the calendar month.
      - name: plan_id_list
        description: Comma-separated list of plan IDs associated with the ultimate parent namespace during the calendar month.
      - name: plan_name_list
        description: Comma-separated list of plan names associated with the ultimate parent namespace during the calendar month.
      - name: namespace_is_internal
        description: '{{ doc("namespace_is_internal") }}'
      - name: ultimate_parent_namespace_type
        description: '{{ doc("ultimate_parent_namespace_type") }}'
      - name: namespace_creator_is_blocked
        description: '{{ doc("namespace_creator_is_blocked") }}'
      - name: first_day_of_reporting_period
        description: First day of the 28-day reporting period used for xMAU and PI reporting. Defined as `DATEADD('day', -27, LAST_DAY(event_calendar_month))`
      - name: last_day_of_reporting_period
        description: Last day of the 28-day reporting period used for xMAU and PI reporting. Defined as `LAST_DAY(event_calendar_month)`
      - name: has_event_during_reporting_period
        description: Boolean flag set to True of the ultimate parent namespace has at least 1 event during the reporting period (i.e., last 28 days of the month). Filter to True in order to have this model tie out to "official" reporting models (ex. rpt_event_xmau_metric_monthly)
      - name: created_by
        description: '{{ doc("created_by") }}'
      - name: updated_by
        description: '{{ doc("updated_by") }}'
      - name: model_created_date
        description: '{{ doc("model_created_date") }}'
      - name: model_updated_date
        description: '{{ doc("model_updated_date") }}'
      - name: dbt_updated_at
      - name: dbt_created_at
  
  - name: wk_rpt_namespace_onboarding
    description: '{{ doc("wk_rpt_namespace_onboarding") }}'
    columns:
      - name: ultimate_parent_namespace_id
        description: '{{ doc("dim_ultimate_parent_namespace_id") }}'
        tests:
          - not_null
          - unique
      - name: namespace_created_at
        description: '{{ doc("namespace_created_at") }}'
      - name: namespace_created_date
        description: '{{ doc("namespace_created_date") }}'
      - name: namespace_created_month
        description: The month of the ultimate parent namespace creation.
      - name: namespace_created_week
        description: The week of the ultimate parent namespace creation.
      - name: creator_id
        description: The user identifier of the ultimate parent namespace creator.
      - name: sfdc_record_id
        description: Functional analytics team owner is Marketing Analytics. Is the SFDC ID of namespace creator. This could be either a lead or contact in SFDC. Joined from dim_crm_person 
      - name: namespace_type
        description: '{{ doc("ultimate_parent_namespace_type") }}'
      - name: setup_for_company
        description: User level setting of the ultimate parent namespace creator.
      - name: visibility_level
        description: '{{ doc("visibility_level") }}'
      - name: current_gitlab_plan_id
        description: gitlab_plan_id of the ultimate parent namespace from common.dim_namespace
      - name: current_gitlab_plan_title
        description: Cleaned plan name plan_name_modified from common_prep.prep_gitlab_dotcom_plan
      - name: current_project_count
        description: The number of projects that are presently associated with the namespace.
      - name: days_since_namespace_creation
        description: Days since namespace creation when model was last refreshed. This can be used to filter by ultimate parent namespace maturity.
      - name: handraise_pql_date
        description: Date of 'Hand Raise PQL' product_interation from customers_db_leads
      - name: is_namespace_created_within_2min_of_creator_invite_acceptance
        description: Creator invite accepted at timestamp within 2min of creating the ultimate parent namespace. This can be used to filter out namespaces that may have lower intent to purchase.
      - name: trial_start_date
        description: First trial start date associated with the ultimate parent namespace from customers_db_trial_histories.
      - name: days_since_namespace_creation_at_trial
        description: Date difference in days between ultimate parent namespace creation and trial start.
      - name: first_paid_subscription_start_date
        description: Date of first paid ultimate parent namespace subscription from customers_db_charges_xf.
      - name: days_since_namespace_creation_at_first_paid_subscription
        description: Date difference in days between ultimate parent namespace creation and first paid subscription from customers_db_charges_xf.
      - name: first_paid_plan_name
        description: Name of plan associated with first paid ultimate parent namespace subscription from customers_db_charges_xf. 
      - name: is_first_paid_plan_purchased_through_subscription_portal
      - name: days_since_namespace_creation_at_activation_event 
        description: Date difference in days between ultimate parent namespace creation and first team activation event. 
      - name: activation_event_array 
        description: Aggregated array of all team activation events triggered within 14 days of ultimate parent namespace creation.
      - name: acitivity_between_d60_d90
        description: Boolean indicating any Gitlab.com event from postgres replica events triggered between 60 and 90 days post namespace creation.
      - name: creator_is_valuable_signup 
        description: Ultimate parent namespace creator signed up for Gitlab.com using a business email domain.
      - name: namespace_contains_valuable_signup
        description: Any billable member of the ultimate parent namespace signed up for Gitlab.com using a business email domain.
      - name: has_team_activation
        description: Boolean indicating that any team activation events were triggered within 14 days.
      - name: namespace_creator_role 
        description: Role selected by the creator of the ultimate parent namespace. 
      - name: namespace_creator_jtbd
        description: JTBD selected indicated by the creator of the ultimate parent namespace.  
      - name: namespace_creator_is_first_order_person
        description: Functional analytics team owner is Marketing Analytics. Is First Order field from the lead and contact model in SFDC joined from dim_crm_person through dim_marketing_contact. When this value is true, the creator of the namespace is a first order person in SFDC right now. This join is ultimately is created by matching email addresses.
      - name: days_since_namespace_creation_at_first_plan_event_date
        description: Date difference in days between ultimate parent namespace creation and first Gitlab.com event triggered in Stage. This does not include events triggered in Learn GitLab projects.
      - name: days_since_namespace_creation_at_first_secure_event_date
        description: Date difference in days between ultimate parent namespace creation and first Gitlab.com event triggered in Stage. This does not include events triggered in Learn GitLab projects.
      - name: days_since_namespace_creation_at_first_create_event_date
        description:  Date difference in days between ultimate parent namespace creation and first Gitlab.com event triggered in Stage. This does not include events triggered in Learn GitLab projects.
      - name: days_since_namespace_creation_at_first_verify_event_date
        description: Date difference in days between ultimate parent namespace creation and first Gitlab.com event triggered in Stage. This does not include events triggered in Learn GitLab projects.
      - name: days_since_namespace_creation_at_first_release_event_date
        description: Date difference in days between ultimate parent namespace creation and first Gitlab.com event triggered in Stage. This does not include events triggered in Learn GitLab projects.
      - name: days_since_latest_plan_event_date
        description: Date difference in days between ultimate parent namespace creation and latest Gitlab.com event triggered in Stage. This does not include events triggered in Learn GitLab projects.
      - name: days_since_latest_secure_event_date
        description: Date difference in days between ultimate parent namespace creation and latest Gitlab.com event triggered in Stage. This does not include events triggered in Learn GitLab projects.
      - name: days_since_latest_create_event_date 
        description: Date difference in days between ultimate parent namespace creation and latest Gitlab.com event triggered in Stage. This does not include events triggered in Learn GitLab projects.
      - name: days_since_latest_verify_event_date
        description: Date difference in days between ultimate parent namespace creation and latest Gitlab.com event triggered in Stage. This does not include events triggered in Learn GitLab projects.
      - name: days_since_latest_release_event_date
        description: Date difference in days between ultimate parent namespace creation and latest Gitlab.com event triggered in Stage. This does not include events triggered in Learn GitLab projects.
      - name: stage_adoption_order
        description: Aggregation of Stage events adopted in the order that they were initially triggered. This does not include events triggered in Learn GitLab projects.
      - name: total_stages_adopted
        description: Unique count of product stages adopted all time.
      - name: current_billable_member_count
        description: Count of users with membership to the ultimate parent namespace where is_billable = True.
      - name: current_month_storage_gib  
        description: Ultimate parent namespace's current month storage_gib from fct_usage_storage.
      - name: first_activity_date  
        description: Date of first event triggered in Gitlab.com.
      - name: latest_activity_date 
        description: Date of latest event triggered in Gitlab.com.
      - name: team_activation_date 
        description: First date any team activation event was triggered.
      - name: dbt_updated_at
      - name: dbt_created_at

  - name: suggested_merge_request_reviewers
    description: Table for exploring the suggested reviewers for a merge request

  - name: wk_gitlab_dotcom_namespace_details
    description: Workspace table for exposing gitlab_dotcom_namespace_details table to Sisense.

  - name: wk_gitlab_dotcom_namespace_details_snapshots
    description: Workspace table for exposing gitlab_dotcom_namespace_details_snapshots table to Sisense.

  - name: wk_gitlab_dotcom_web_hooks
    description: Workspace table for exposing gitlab_dotcom_web_hooks table to Sisense.

  - name: wk_usage_ping_geo_node_usage
    description: Workspace table for Service ping geo node usage
    columns:
      - name: uploaded_at
        description: '{{ doc("wk_usage_ping_geo_node_usage_uploaded_at") }}'
        tests:
          - not_null